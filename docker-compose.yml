services:
  raptor-gateway:
    build: .
    container_name: raptor-gateway
    restart: always
    network_mode: host
    volumes:
      - raptor-network-spinner_status-data:/var/run/network-status-vol:ro
      - gateway-data:/var/lib/raptor
    environment:
      - NETWORK_STATUS_FILE=/var/run/network-status-vol/network-status
      - LOCAL_MQTT_URL=tcp://localhost:1883
      - CLOUD_MQTT_URL=tcp://3.141.116.27:1883
      - CLOUD_MQTT_USER=raptor
      - CLOUD_MQTT_PASS=raptorMQTT2025
      - RAPTOR_SITE=shop
      - RAPTOR_DEVICE=revpi-135593
      - SQLITE_PATH=/var/lib/raptor/gateway.db
      - RETENTION_DAYS=30
      # Supabase sync (set these to enable cloud analytics)
      - SUPABASE_URL=${SUPABASE_URL:-}
      - SUPABASE_KEY=${SUPABASE_KEY:-}
      - SYNC_BATCH_SIZE=100
      - SYNC_INTERVAL_SEC=30
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  raptor-network-spinner_status-data:
    external: true
  gateway-data:
